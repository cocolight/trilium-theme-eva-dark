/* =========================================================
   EVA Dark Theme for Trilium
   把下面整段贴进「Options → Appearance → Custom CSS」即可
   ========================================================= */

/* -------- 1. 语义化令牌映射（原 :root 部分） -------- */
:root {
    /* 基础品牌色 */
    --theme-style: dark;

    /* ---- 字体保持原尺寸，只换颜色 ---- */
    --main-font-family: Helvetica, sans-serif;
    --main-font-size: normal;
    --main-text-color: var(--eva-editor-foreground);

    --tree-font-family: Helvetica, sans-serif;
    --tree-font-size: normal;

    --detail-font-family: Helvetica, sans-serif;
    --detail-font-size: normal;

    --monospace-font-family: 'Lucida Console', 'Courier New', Courier, monospace;
    --monospace-font-size: normal;

    /* ---- 基础背景 ---- */
    --eva-editor-background: #282c34;
    --eva-editor-foreground: #9da5b3;

    --eva-sideBar-background: #21252b;
    --eva-sideBar-foreground: #8e99b1;

    --eva-input-background: #23272f;
    --eva-input-border: #181a1f;
    --eva-input-foreground: #9da5b3;

    --eva-dropdown-background: #23272f;
    --eva-dropdown-border: #181a1f;
    --eva-dropdown-foreground: #9da5b3;

    --eva-menu-background: #21252b;
    --eva-menu-foreground: #8e99b1;

    --eva-button-background: #676e9599;
    --eva-button-foreground: #dcdfe5;
    --eva-button-hoverBackground: #598defe6;

    --eva-badge-background: #676e95e5;
    --eva-badge-foreground: #ced5e1;

    /* ---- 编辑器语义高亮 ---- */
    --eva-editor-selectionBackground: #598def59;
    --eva-editor-lineHighlightBackground: #2f323c;
    --eva-editor-wordHighlightBackground: #0080997f;
    --eva-editor-wordHighlightStrongBackground: #a78cfa72;

    /* ---- 差异对比 ---- */
    --eva-diffEditor-insertedTextBackground: #4ec15033;
    --eva-diffEditor-removedTextBackground: #f14c4c4c;

    /* ---- 终端 ---- */
    --eva-terminal-background: #282c34;
    --eva-terminal-foreground: #b0b7c3;
    --eva-terminal-ansiRed: #e51400;
    --eva-terminal-ansiGreen: #4ec150;
    --eva-terminal-ansiYellow: #e4bf7f;
    --eva-terminal-ansiBlue: #4283f5;
    --eva-terminal-ansiMagenta: #cf68e1;
    --eva-terminal-ansiCyan: #56b7c3;
    --eva-terminal-ansiWhite: #fff;

    /* ---- 列表/树 ---- */
    --eva-list-activeSelectionBackground: #598def66;
    --eva-list-activeSelectionForeground: #d7dae0;
    --eva-list-hoverBackground: #598def66;
    --eva-list-inactiveSelectionBackground: #30333d;

    /* ---- 通知 ---- */
    --eva-notifications-background: #21252b;
    --eva-notifications-foreground: #b0b7c3;

    /* ---- 状态栏 ---- */
    --eva-statusBar-background: #21252b;
    --eva-statusBar-foreground: #9da5b3;

    /* ---- 标题栏 ---- */
    --eva-titleBar-activeBackground: #282c34;
    --eva-titleBar-activeForeground: #8e99b1;

    /* ---- 活动栏 ---- */
    --eva-activityBar-background: #282c34;
    --eva-activityBar-foreground: #96a4cd;
    --eva-activityBar-inactiveForeground: #5c617d;

    /* ---- 标签页 ---- */
    --eva-tab-activeBackground: #282c34;
    --eva-tab-activeForeground: #d7dae0;
    --eva-tab-inactiveBackground: #21252b;
    --eva-tab-inactiveForeground: #676e95;

    /* ---- 面板 ---- */
    --eva-panel-background: #282c34;
    --eva-panel-foreground: #b0b7c3;
    --eva-panel-border: #21252b;

    /* ---- Peek 视图 ---- Trilium 没有 */
    --eva-peekView-border: #535773;
    --eva-peekViewEditor-background: #2d3039;
    --eva-peekViewResult-background: #282c34;
    --eva-peekViewTitle-background: #282c34;

    /* ---- 滚动条 ---- */
    --eva-scrollbarSlider-background: #a2abe533;
    --eva-scrollbarSlider-hoverBackground: #a2abe54c;
    --eva-scrollbarSlider-activeBackground: #a2abe54c;

    /* ---- 其他常用 ---- */
    --eva-focusBorder: #4480f4;
    --eva-errorForeground: #e51400;
    --eva-descriptionForeground: #b0b7c3bf;
    --eva-disabledForeground: #cccccc80;

    /* ---- 背景 / 边框 ---- */
    --main-background-color: var(--eva-editor-background);
    --main-border-color: var(--eva-panel-border);

    --accented-background-color: var(--eva-panel-background);
    --more-accented-background-color: var(--eva-sideBar-background);

    /* ---- 按钮 ---- */
    --button-background-color: var(--eva-button-background);
    --button-border-color: transparent;
    --button-text-color: var(--eva-button-foreground);
    --button-border-radius: 3px;
    --button-disabled-background-color: transparent;
    --button-disabled-text-color: var(--eva-disabledForeground);

    --primary-button-background-color: var(--eva-button-hoverBackground);
    --primary-button-text-color: #fff;
    --primary-button-border-color: transparent;

    /* ---- 输入 ---- */
    --input-text-color: var(--eva-input-foreground);
    --input-background-color: var(--eva-input-background);

    /* ---- 列表/树 选中+悬停 ---- */
    --hover-item-text-color: var(--eva-list-hoverBackground);
    --hover-item-background-color: transparent;
    --hover-item-border-color: var(--eva-focusBorder);

    --active-item-text-color: var(--eva-list-activeSelectionForeground);
    --active-item-background-color: var(--eva-list-activeSelectionBackground);
    --active-item-border-color: transparent;

    /* ---- 菜单/下拉 ---- */
    --menu-text-color: var(--eva-menu-foreground);
    --menu-background-color: var(--eva-menu-background);

    --dropdown-menu-background: var(--eva-dropdown-background);
    --dropdown-menu-border: var(--eva-dropdown-border);

    /* ---- 模态框 ---- */
    --modal-background-color: var(--eva-dropdown-background);
    --modal-backdrop-color: rgba(33,37,43,.75);

    /* ---- 左栏 / 右栏 ---- */
    --left-pane-background-color: var(--eva-sideBar-background);
    --left-pane-text-color: var(--eva-sideBar-foreground);

    --launcher-pane-background-color: var(--eva-activityBar-background);
    --launcher-pane-text-color: var(--eva-activityBar-inactiveForeground);

    /* ---- 标签页 ---- */
    --active-tab-background-color: var(--eva-tab-activeBackground);
    --active-tab-hover-background-color: var(--eva-tab-activeBackground);
    --active-tab-text-color: var(--eva-tab-activeForeground);

    --inactive-tab-background-color: var(--eva-tab-inactiveBackground);
    --inactive-tab-hover-background-color: var(--eva-list-hoverBackground);
    --inactive-tab-text-color: var(--eva-tab-inactiveForeground);

    /* ---- 其他细节 ---- */
    --scrollbar-border-color: var(--eva-panel-border);
    --tooltip-background-color: var(--eva-dropdown-background);
    --link-color: var(--eva-terminal-ansiBlue);

    --muted-text-color: var(--eva-descriptionForeground);

    /* Mermaid / Editor 额外 */
    --mermaid-theme: dark;
    --ck-color-code-block-label-background: var(--eva-dropdown-background);
}

/* -------- 2. 强制覆盖 Trilium 写死样式 -------- */

/* 滚动条滑块 */
::-webkit-scrollbar-thumb {
    background: var(--eva-scrollbarSlider-background);
}
::-webkit-scrollbar-thumb:hover {
    background: var(--eva-scrollbarSlider-hoverBackground);
}
::-webkit-scrollbar-thumb:active {
    background: var(--eva-scrollbarSlider-activeBackground);
}

/* 日历选择器 */
body ::-webkit-calendar-picker-indicator {
    filter: invert(1) hue-rotate(180deg);
}

/* CodeMirror 反色适配 */
body .CodeMirror {
    filter: invert(90%) hue-rotate(180deg);
}

/* Excalidraw 暗黑 */
.excalidraw.theme--dark {
    --theme-filter: none !important;
    background: var(--eva-editor-background) !important;
}

/* 分割条 */
.gutter {
    width: 2px !important;
    background: var(--eva-panel-border) !important;
}

/* 树图标 */
span.fancytree-custom-icon {
    color: var(--eva-terminal-ansiCyan) !important;
    background: none;
}

/* 树工具栏 */
.tree-actions {
    background-color: var(--eva-sideBar-background) !important;
}

/* 树节点 */
span.fancytree-active {
    border: 0 !important;
    background-color: var(--eva-list-activeSelectionBackground) !important;
}
span.fancytree-active .fancytree-title {
    font-weight: normal !important;
}

span.fancytree-node:hover {
    border: 0 !important;
    background-color: var(--eva-list-hoverBackground) !important;
}
.fancytree-node {
    height: 28px !important;
    border: 0 !important;
}

/* 第 1 级（顶层父标题）*/
.fancytree-container > li > span .fancytree-title {
    color: var(--eva-terminal-ansiCyan);
    font-size: 1.28em;
    font-weight: 600;
}

/* 第 2 级（子标题）*/
.fancytree-container > li > ul > li > span .fancytree-title {
    color: var(--eva-terminal-ansiMagenta);
    font-size: 1.08em;
    font-weight: 500;
}

/* 第 3 级（孙标题）*/
.fancytree-container > li > ul > li > ul > li > span .fancytree-title {
    color: var(--eva-terminal-ansiGreen);
    font-size: .98em;
    font-weight: 400;
}

/* 第 4 级及以下（更弱）*/
.fancytree-container > li > ul > li > ul > li > ul > li > span .fancytree-title {
    color: var(--eva-terminal-ansiYellow);
    font-size: .92em;
    font-weight: 400;
    opacity: .9;
}

/* 标签栏 */
.tab-row-filler {
    background-color: var(--eva-tab-inactiveBackground) !important;
    height: 90% !important;
}
.tab-row-widget .note-tab .note-tab-wrapper {
    border-radius: 0 !important;
}
.tab-row-widget .note-tab[active] .note-tab-wrapper {
    font-weight: normal !important;
    border-radius: 0 !important;
}

/* 笔记卡片 */
.note-book-card {
    border-radius: 0 !important;
    background-color: var(--eva-panel-background) !important;
}

/* 悬浮添加按钮 */
button.tree-floating-button {
    border: 0 transparent !important;
}
button.tree-floating-button:hover {
    border: 0 transparent !important;
    background-color: var(--eva-button-hoverBackground) !important;
}

/* CK 代码块 */
.ck-content pre {
    border: 1px solid var(--eva-dropdown-border) !important;
    border-radius: 0 !important;
    background-color: var(--eva-editor-background) !important;
}

/* 左上角汉堡 */
div#launcher-pane .global-menu-button {
    filter: invert(.5);
}
div#launcher-pane .global-menu-button:hover {
    filter: invert(0);
}

/* === 启动器和侧边栏 === */
div#launcher-pane .component button:hover {
    color: var(--eva-terminal-ansiCyan) !important;
    background: var(--eva-editor-selectionBackground) !important;
}

/* 新建页 */
.note-new-tab {
    background-color: var(--eva-sideBar-background) !important;
}

/* 右栏 */
#right-pane {
    background-color: var(--eva-sideBar-background) !important;
}

/* 下拉菜单 */
.dropdown-menu.show {
    background-color: var(--eva-dropdown-background) !important;
    border: 1px solid var(--eva-dropdown-border) !important;
}

/* 按钮 focus 阴影 */
.btn-primary.focus,
.btn-primary:focus {
    box-shadow: none;
}

/* Ribbon 顶部工具栏 */
.ribbon-tab-title {
    color: var(--eva-descriptionForeground) !important;
    border-bottom: 1px solid var(--eva-panel-border) !important;
}
.ribbon-tab-spacer {
    border-bottom: 1px solid var(--eva-panel-border) !important;
}
.ribbon-button-container {
    border-bottom: 1px solid var(--eva-panel-border) !important;
}
.ribbon-button-container .icon-action {
    color: var(--eva-descriptionForeground) !important;
}

/* 标题栏高度 */
.title-row {
    height: 70px !important;
    min-height: 70px !important;
    padding-top: 20px !important;
}
#right-pane .card-header {
    padding: 8px !important;
}

/* CK 列表 hover */
.ck.ck-list__item .ck-button:hover:not(.ck-disabled) {
    background: var(--eva-list-hoverBackground);
}

/* === 单选框和复选框 === */
input[type="checkbox"],
input[type="radio"] {
    filter: none !important;
    appearance: none;
    -webkit-appearance: none;
    width: 16px;
    height: 16px;
    border: 1px solid var(--eva-input-border) !important;
    background: var(--eva-input-background) !important;
    border-radius: 3px;
    position: relative;
    cursor: pointer;
}

input[type="radio"] {
    border-radius: 50% !important;
}

input[type="checkbox"]:checked,
input[type="radio"]:checked {
    background: var(--eva-terminal-ansiCyan) !important;
    border-color: var(--eva-terminal-ansiCyan) !important;
}

input[type="checkbox"]:checked::before {
    content: "✓";
    position: absolute;
    color: var(--eva-input-background);
    font-weight: bold;
    font-size: 12px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

input[type="radio"]:checked::before {
    content: "";
    position: absolute;
    width: 6px;
    height: 6px;
    background: var(--eva-input-background);
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

input[type="checkbox"]:hover,
input[type="radio"]:hover {
    border-color: var(--eva-terminal-ansiCyan) !important;
}

/* === left-panel 的 quick-search === */
/* 1. 给 quick-search 整体左侧 10 px 内边距 */
.quick-search {
    padding: 10px !important;
}

/* 2. 按钮隐身且不占宽度 */
.quick-search .search-button {
    visibility: hidden;
    width: 0 !important;
    min-width: 0 !important;
    padding: 0 !important;
    border: 0 !important;
    margin: 0 !important;
}

/* 3. 输入框圆角收回，视觉对齐 */
.quick-search .form-control {
    border-top-left-radius: var(--bs-border-radius-sm) !important;
    border-bottom-left-radius: var(--bs-border-radius-sm) !important;
}